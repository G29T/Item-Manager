<mat-form-field>
  <mat-label>Sort By</mat-label>
  <mat-select (selectionChange)="setSortingCriterion($event.value)">
    <mat-option value="dateAsc">Date Asc</mat-option>
    <mat-option value="dateDsc">Date Dsc</mat-option>
  </mat-select>
</mat-form-field>

<mat-form-field>
  <mat-label>
    Filter By Status:
    <mat-select (selectionChange)="setFilterStatus($event.value)">
      <mat-option value="">All</mat-option>
      <mat-option value="Pending">Pending</mat-option>
      <mat-option value="Accepted">Accepted</mat-option>
      <mat-option value="Rejected">Rejected</mat-option>
      <mat-option value="Withdrawn">Withdrawn</mat-option>
      <mat-option value="FinalisedAccepted">Finalised - Accepted</mat-option>
    </mat-select>
  </mat-label>
</mat-form-field>


<div *ngIf="(proposalsByItem$ | async) as proposals">
  <ul *ngIf="proposals?.length">
    <li *ngFor="let proposal of proposals">
      <div>Proposal ID: <strong>{{ proposal.id }}</strong></div>
      <div *ngIf="proposal.counterProposalToId">
        Counterproposal To ID: <strong>{{ proposal.counterProposalToId }}</strong>
      </div>
      <strong>{{ proposal.createdAt | date }}</strong>
      <br>
      <span>{{ proposal.comment }}</span>
      <span [ngClass]="{ accepted: proposal.status === 'Accepted', rejected: proposal.status === 'Rejected' }">
        ({{ proposal.status }})
        <span *ngIf="proposal.status === 'Pending'" class="material-icons">hourglass_empty</span>
        <span *ngIf="proposal.status === 'Accepted'" class="material-icons">check_circle</span>
        <span *ngIf="proposal.status === 'Rejected'" class="material-icons">cancel</span>
        <span *ngIf="proposal.status === 'Withdrawn'" class="material-icons">remove_circle</span>
      </span>


      <ng-container *ngIf="(currentUserId$ | async) as currentUserId">
        <ng-container *ngIf="proposal.creatorInfo">
          <p *ngIf="currentUserId === proposal.creatorInfo.partyId">
            Created by: <strong>{{ proposal.creatorInfo.name }}</strong>
          </p>
        </ng-container>
      </ng-container>
      <div *ngFor="let ownerId of proposal.ownerIds">
        <ng-container *ngIf="getOwnerNameById(ownerId) | async as ownerName">
          <p>{{ ownerName }} - Payment Ratio: {{ proposal.paymentRatios[ownerId] }}</p>
        </ng-container>
      </div>      
      <button *ngIf="proposal.status !== 'Withdrawn' && proposal.status !== 'Accepted' && proposal.status !== 'Finalised - Accepted' && proposal.status !== 'Rejected' && (currentUserId$ | async) === proposal.userId" (click)="withdrawProposal(proposal)">Withdraw</button>
      <button *ngIf="proposal.status !== 'Rejected' && proposal.status !== 'Withdrawn' && proposal.status !== 'Accepted' && proposal.status !== 'Finalised - Accepted' && (currentUserId$ | async) !== proposal.userId" (click)="acceptProposal(proposal)">Accept</button>
      <button *ngIf="proposal.status !== 'Rejected' && proposal.status !== 'Withdrawn' && proposal.status !== 'Accepted' && proposal.status !== 'Finalised - Accepted' && (currentUserId$ | async) !== proposal.userId" (click)="openCounterProposalDialog(proposal)">Reject</button>
    
      <span *ngIf="(getAcceptedPartyMembers(proposal) | async) as acceptedUsers">
        <ng-container *ngIf="acceptedUsers.length > 0">
          Accepted by: 
          <span *ngFor="let user of acceptedUsers; let isLast = last">
            {{ user.name }}<span *ngIf="!isLast">, </span>
          </span>
        </ng-container>
      </span>
      
    
    </li>
  </ul>
  <p *ngIf="!proposals?.length">No proposals available for this item.</p>
</div>
